<!-- PASTE THIS ENTIRE CODE BLOCK INTO: views/partials/footer.ejs -->

<script nonce="<%= nonce %>">
    // Create a global object to hold all our translated strings for client-side JS
    window.translations = {
        sending: "<%- t('buttons.sending') %>",
        confirmOrder: "<%- t('buttons.confirmOrder') %>",
        placeOrder: "<%- t('buttons.placeOrder') %>",
        fillRequiredFields: "<%- t('toasts.fillRequiredFields') %>",
        invalidPhoneNumber: "<%- t('toasts.invalidPhoneNumber') %>",
        enterAddress: "<%- t('toasts.enterAddress') %>",
        orderReceived: "<%- t('toasts.orderReceived') %>",
        connectionError: "<%- t('toasts.connectionError') %>",
        orderWillBeSent: "<%- t('toasts.orderWillBeSent') %>",
        sendingInProgress: "<%- t('toasts.sendingInProgress') %>",
        selectWilayaToast: "<%- t('toasts.selectWilayaToast') %>",
        itemAddedToCart: "<%- t('toasts.itemAddedToCart') %>",
        stopDeskInfo: "<%- t('cart.stopDeskInfo') %>"
    };
</script>


<footer class="site-footer">
    <hr class="footer-separator">
    <div class="footer-content">
        <a href="/" class="footer-logo">
            <img src="/images/bloom-logo.webp" alt="Bloom Logo" class="footer-logo-img">
        </a>
         <div class="footer-links">
            <a href="/politique-de-confidentialite"><%= t('footer.privacyPolicy') %></a>
            <span>&bull;</span>
            <a href="/conditions-generales-de-vente"><%= t('footer.termsOfSale') %></a>
        </div>
        <ul class="footer-socials">
            <li>
                <a href="https://instagram.com/bloom.oil_" target="_blank" rel="noopener noreferrer" aria-label="Instagram">
                    <svg viewBox="0 0 24 24" width="24" height="24" fill="currentColor"><path d="M7.8,2H16.2C19.4,2 22,4.6 22,7.8V16.2A5.8,5.8 0 0,1 16.2,22H7.8C4.6,22 2,19.4 2,16.2V7.8A5.8,5.8 0 0,1 7.8,2M7.6,4A3.6,3.6 0 0,0 4,7.6V16.4C4,18.39 5.61,20 7.6,20H16.4A3.6,3.6 0 0,0 20,16.4V7.6C20,5.61 18.39,4 16.4,4H7.6M17.25,5.5A1.25,1.25 0 0,1 18.5,6.75A1.25,1.25 0 0,1 17.25,8A1.25,1.25 0 0,1 16,6.75A1.25,1.25 0 0,1 17.25,5.5M12,7A5,5 0 0,1 17,12A5,5 0 0,1 12,17A5,5 0 0,1 7,12A5,5 0 0,1 12,7M12,9A3,3 0 0,0 9,12A3,3 0 0,0 12,15A3,3 0 0,0 15,12A3,3 0 0,0 12,9Z" /></svg>
                </a>
            </li>
            <li>
                <a href="https://www.tiktok.com/@bloom.oil" target="_blank" rel="noopener noreferrer" aria-label="TikTok">
                    <i class="fa-brands fa-tiktok"></i>
                </a>
            </li>
        </ul>
        <p class="footer-copyright"><%= t('footer.copyright') %></p>
    </div>
</footer>

<!-- Toasts and Drawers -->

<div id="custom-toast-notification" class="custom-toast">
    <div class="toast-icon"></div>
    <p class="toast-message" id="toast-message-text"></p>
</div>

<div id="undo-toast-notification" class="custom-toast undo-toast">
    <div class="toast-content">
        <p class="toast-message" id="undo-toast-message"></p>
        <button id="undo-toast-button" class="undo-button"><%= t('buttons.undo') %></button>
    </div>
    <div class="toast-progress-bar" id="undo-toast-progress"></div>
</div>

<div id="direct-checkout-drawer" class="checkout-drawer">
    <div id="drawer-overlay" class="drawer-overlay"></div>
    <div id="drawer-panel" class="drawer-panel">
        <div class="drawer-header">
            <h2><%= t('drawers.expressCheckout') %></h2>
            <button id="drawer-close-btn" class="drawer-close-btn" aria-label="<%= t('aria.close') %>">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 5 6.41z"></path></svg>
            </button>
        </div>
        <div class="drawer-body">
            <div id="drawer-item-display" class="drawer-item"></div>
            <form id="direct-checkout-form" class="drawer-form" novalidate>
                <h3><%= t('drawers.shippingInfo') %></h3>
                <div class="form-group">
                    <label for="drawer-fullName"><%= t('forms.fullName') %></label>
                    <input type="text" id="drawer-fullName" name="fullName" required>
                </div>
                <div class="form-group">
                    <label for="drawer-phone"><%= t('forms.phoneNumber') %></label>
                    <input type="tel" id="drawer-phone" name="phone" required>
                </div>
                <div class="form-group">
                    <label for="drawer-wilaya"><%= t('forms.wilaya') %></label>
                    <div class="custom-select">
                        <select id="drawer-wilaya" name="wilaya" required>
                            <option value="" disabled selected><%= t('forms.selectWilaya') %></option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label><%= t('forms.deliveryMethod') %></label>
                    <div class="radio-group">
                        <label for="drawer-delivery-home">
                            <input type="radio" id="drawer-delivery-home" name="deliveryMethod" value="home" checked>
                            <%= t('forms.homeDelivery') %>
                        </label>
                        <label for="drawer-delivery-stopdesk" id="drawer-stopdesk-label">
                            <input type="radio" id="drawer-delivery-stopdesk" name="deliveryMethod" value="stopdesk">
                            <%= t('forms.stopDesk') %>
                        </label>
                    </div>
                </div>
                <div class="form-group" id="drawer-address-container">
                    <label for="drawer-address"><%= t('forms.fullAddress') %></label>
                    <textarea id="drawer-address" name="address" rows="3" required></textarea>
                </div>
                <div class="form-group" id="drawer-stopdesk-container" style="display: none;">
                    <label><%= t('forms.relayPoint') %></label>
                    <div id="drawer-stopdesk-info"></div>
                </div>
            </form>
        </div>
        <div class="drawer-footer">
            <div class="drawer-total">
                <span>Total</span>
                <div class="drawer-price-wrapper">
                    <span id="drawer-original-shipping-price" class="original-price" style="display: none;"></span>
                    <span id="drawer-total-price">0,00 DA</span>
                </div>
            </div>
            <button id="drawer-confirm-order-btn" class="btn-primary" type="submit" form="direct-checkout-form">
                <%= t('buttons.confirmOrder') %>
            </button>
        </div>
    </div>
</div>

<!-- ================================================== -->
<!--          END: RESTORED TOASTS & DRAWERS            -->
<!-- ================================================== -->


<!-- ================================================== -->
<!--                 ALL SITE SCRIPTS                   -->
<!-- ================================================== -->

<!-- Dynamic User Data -->
<script nonce="<%= nonce %>">
    window.USER_DETAILS = <%- JSON.stringify(userDetails || null) %>;
</script>

<!-- External Libraries -->
<script src="https://kit.fontawesome.com/dda4e988bf.js" crossorigin="anonymous" nonce="<%= nonce %>"></script>

<!-- Local Cookie Consent Library -->
<link rel="stylesheet" href="/styles/consent-banner.css">
<script src="/functions/consent-banner.js" nonce="<%= nonce %>"></script>

<!-- ================================================== -->
<!--           START: REVISED SCRIPT LOADING            -->
<!-- ================================================== -->

<!-- 1. Global Scripts (Load on EVERY page) -->
<script src="/functions/script.js" nonce="<%= nonce %>"></script>
<script src="/functions/cart.js" nonce="<%= nonce %>"></script>

<!-- 2. Page-Specific Scripts (Load CONDITIONALLY) -->
<% if (typeof pageType !== 'undefined') { %>

    <% if (pageType === 'cart') { %>
        <script src="/functions/panier.js" nonce="<%= nonce %>"></script>
    <% } %>

    <% if (pageType === 'product') { %>
        <script src="/functions/product.js" nonce="<%= nonce %>"></script>
        <script src="/functions/pack.js" nonce="<%= nonce %>"></script>
        <script src="/functions/direct-checkout.js" nonce="<%= nonce %>"></script>
    <% } %>

    <% if (pageType === 'results') { %>
        <script src="/functions/resultats.js" nonce="<%= nonce %>"></script>
    <% } %>

    <% if (pageType === 'admin') { %>
        <script src="/functions/admin.js" nonce="<%= nonce %>"></script>
    <% } %>

    <% if (pageType === 'faq') { %> <!-- ADD THIS BLOCK -->
        <script src="/functions/faq.js" nonce="<%= nonce %>"></script>
    <% } %>


<% } %>

<!-- ================================================== -->
<!--            END: REVISED SCRIPT LOADING             -->
<!-- ================================================== -->


<!-- Cookie Consent Initialization (MUST BE LAST) -->
<script nonce="<%= nonce %>">
document.addEventListener('DOMContentLoaded', function () {
    if (window.CookieConsent) {
        CookieConsent.run({
            guiOptions: {
                consentModal: {
                    layout: 'box',
                    position: 'bottom left',
                    equalWeightButtons: true,
                    flipButtons: false
                },
                preferencesModal: {
                    layout: 'box',
                    position: 'right',
                    equalWeightButtons: true,
                    flipButtons: false
                }
            },
            categories: {
                necessary: {
                    readOnly: true
                }
            },
            language: {
                default: 'fr',
                translations: {
                    fr: {
                        consentModal: {
                            title: 'Ce site utilise des cookies',
                            description: 'Nous utilisons des cookies pour assurer le bon fonctionnement du site, comme la gestion de votre panier et de votre session. En cliquant sur "Accepter", vous consentez à l\'utilisation de ces cookies essentiels.',
                            acceptAllBtn: 'Accepter',
                            acceptNecessaryBtn: 'Refuser',
                            showPreferencesBtn: 'Gérer les préférences',
                            footer: '<a href="/politique-de-confidentialite">Politique de Confidentialité</a>'
                        },
                        preferencesModal: {
                            title: 'Préférences de consentement',
                            acceptAllBtn: 'Accepter tout',
                            acceptNecessaryBtn: 'Refuser tout',
                            savePreferencesBtn: 'Enregistrer',
                            closeIconLabel: 'Fermer',
                            sections: [
                                {
                                    title: 'Utilisation des cookies',
                                    description: 'Nous utilisons des cookies pour le fonctionnement de base du site. Ces cookies sont nécessaires et ne peuvent pas être désactivés.'
                                },
                                {
                                    title: 'Cookies Essentiels <span class="pm__badge">Toujours Actif</span>',
                                    description: 'Ces cookies sont indispensables au fonctionnement du site. Ils permettent de gérer des fonctionnalités de base comme votre panier d\'achat, votre connexion à votre compte, et la sécurité du site.',
                                    linkedCategory: 'necessary'
                                }
                            ]
                        }
                    }
                }
            }
        });
    } else {
        console.error('CookieConsent script not loaded. This is likely due to a browser ad blocker.');
    }
});
</script>


